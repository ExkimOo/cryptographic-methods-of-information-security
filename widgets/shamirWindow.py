# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'shamirWindow.ui'
#
# Created by: PyQt5 UI code generator 5.15.6
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtCore import QRegExp
from PyQt5.QtGui import QRegExpValidator
from PyQt5.QtWidgets import QFileDialog
from sympy.ntheory import isprime

from utils.primes import generate_prime
from cyphers.shamir_cypher import generate_c_d, send_message


class Ui_Shamir(object):
    def setupUi(self, Shamir):
        Shamir.setObjectName("Shamir")
        Shamir.resize(1019, 804)
        self.cypherName = QtWidgets.QLabel(Shamir)
        self.cypherName.setGeometry(QtCore.QRect(30, 10, 959, 29))
        font = QtGui.QFont()
        font.setPointSize(18)
        self.cypherName.setFont(font)
        self.cypherName.setAlignment(QtCore.Qt.AlignCenter)
        self.cypherName.setObjectName("cypherName")
        self.widget = QtWidgets.QWidget(Shamir)
        self.widget.setGeometry(QtCore.QRect(41, 50, 941, 741))
        self.widget.setObjectName("widget")
        self.verticalLayout_3 = QtWidgets.QVBoxLayout(self.widget)
        self.verticalLayout_3.setContentsMargins(0, 0, 0, 0)
        self.verticalLayout_3.setObjectName("verticalLayout_3")
        self.horizontalLayout = QtWidgets.QHBoxLayout()
        self.horizontalLayout.setSizeConstraint(QtWidgets.QLayout.SetDefaultConstraint)
        self.horizontalLayout.setSpacing(26)
        self.horizontalLayout.setObjectName("horizontalLayout")
        self.label = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label.setFont(font)
        self.label.setLayoutDirection(QtCore.Qt.LeftToRight)
        self.label.setAlignment(QtCore.Qt.AlignLeading|QtCore.Qt.AlignLeft|QtCore.Qt.AlignVCenter)
        self.label.setObjectName("label")
        self.horizontalLayout.addWidget(self.label)
        self.p = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.p.setFont(font)
        self.p.setObjectName("p")
        self.horizontalLayout.addWidget(self.p)
        self.label_4 = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_4.setFont(font)
        self.label_4.setObjectName("label_4")
        self.horizontalLayout.addWidget(self.label_4)
        self.bits = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.bits.setFont(font)
        self.bits.setObjectName("bits")
        self.horizontalLayout.addWidget(self.bits)
        self.verticalLayout = QtWidgets.QVBoxLayout()
        self.verticalLayout.setObjectName("verticalLayout")
        self.generate_p = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.generate_p.setFont(font)
        self.generate_p.setObjectName("generate_p")
        self.verticalLayout.addWidget(self.generate_p)
        self.isPrime = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.isPrime.setFont(font)
        self.isPrime.setObjectName("isPrime")
        self.verticalLayout.addWidget(self.isPrime)
        self.horizontalLayout.addLayout(self.verticalLayout)
        self.verticalLayout_3.addLayout(self.horizontalLayout)
        self.find_ca_da_cb_db = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.find_ca_da_cb_db.setFont(font)
        self.find_ca_da_cb_db.setObjectName("find_ca_da_cb_db")
        self.verticalLayout_3.addWidget(self.find_ca_da_cb_db)
        self.verticalLayout_2 = QtWidgets.QVBoxLayout()
        self.verticalLayout_2.setObjectName("verticalLayout_2")
        self.horizontalLayout_2 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_2.setObjectName("horizontalLayout_2")
        self.label_2 = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_2.setFont(font)
        self.label_2.setObjectName("label_2")
        self.horizontalLayout_2.addWidget(self.label_2)
        self.ca = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.ca.setFont(font)
        self.ca.setObjectName("ca")
        self.horizontalLayout_2.addWidget(self.ca)
        self.label_5 = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_5.setFont(font)
        self.label_5.setObjectName("label_5")
        self.horizontalLayout_2.addWidget(self.label_5)
        self.cb = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.cb.setFont(font)
        self.cb.setObjectName("cb")
        self.horizontalLayout_2.addWidget(self.cb)
        self.verticalLayout_2.addLayout(self.horizontalLayout_2)
        self.horizontalLayout_6 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_6.setObjectName("horizontalLayout_6")
        self.label_3 = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_3.setFont(font)
        self.label_3.setObjectName("label_3")
        self.horizontalLayout_6.addWidget(self.label_3)
        self.da = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.da.setFont(font)
        self.da.setReadOnly(True)
        self.da.setObjectName("da")
        self.horizontalLayout_6.addWidget(self.da)
        self.label_6 = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_6.setFont(font)
        self.label_6.setObjectName("label_6")
        self.horizontalLayout_6.addWidget(self.label_6)
        self.db = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.db.setFont(font)
        self.db.setReadOnly(True)
        self.db.setObjectName("db")
        self.horizontalLayout_6.addWidget(self.db)
        self.verticalLayout_2.addLayout(self.horizontalLayout_6)
        self.verticalLayout_3.addLayout(self.verticalLayout_2)
        self.input = QtWidgets.QTextEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.input.setFont(font)
        self.input.setObjectName("input")
        self.verticalLayout_3.addWidget(self.input)
        self.send = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.send.setFont(font)
        self.send.setObjectName("send")
        self.verticalLayout_3.addWidget(self.send)
        self.output = QtWidgets.QTextEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.output.setFont(font)
        self.output.setReadOnly(True)
        self.output.setObjectName("output")
        self.verticalLayout_3.addWidget(self.output)
        self.horizontalLayout_3 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_3.setObjectName("horizontalLayout_3")
        self.inputFileText = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.inputFileText.setFont(font)
        self.inputFileText.setObjectName("inputFileText")
        self.horizontalLayout_3.addWidget(self.inputFileText)
        self.inputFilePath = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.inputFilePath.setFont(font)
        self.inputFilePath.setObjectName("inputFilePath")
        self.horizontalLayout_3.addWidget(self.inputFilePath)
        self.inputFilePathButton = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.inputFilePathButton.setFont(font)
        self.inputFilePathButton.setObjectName("inputFilePathButton")
        self.horizontalLayout_3.addWidget(self.inputFilePathButton)
        self.verticalLayout_3.addLayout(self.horizontalLayout_3)
        self.horizontalLayout_4 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_4.setObjectName("horizontalLayout_4")
        self.outputFileText = QtWidgets.QLabel(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.outputFileText.setFont(font)
        self.outputFileText.setObjectName("outputFileText")
        self.horizontalLayout_4.addWidget(self.outputFileText)
        self.outputFilePath = QtWidgets.QLineEdit(self.widget)
        font = QtGui.QFont()
        font.setPointSize(14)
        self.outputFilePath.setFont(font)
        self.outputFilePath.setObjectName("outputFilePath")
        self.horizontalLayout_4.addWidget(self.outputFilePath)
        self.outputFilePathButton = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.outputFilePathButton.setFont(font)
        self.outputFilePathButton.setObjectName("outputFilePathButton")
        self.horizontalLayout_4.addWidget(self.outputFilePathButton)
        self.verticalLayout_3.addLayout(self.horizontalLayout_4)
        self.encrypt_file = QtWidgets.QPushButton(self.widget)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.encrypt_file.setFont(font)
        self.encrypt_file.setObjectName("encrypt_file")
        self.verticalLayout_3.addWidget(self.encrypt_file)

        self.retranslateUi(Shamir)
        QtCore.QMetaObject.connectSlotsByName(Shamir)

        self.bits.setText('1024')

        self.generate_p.clicked.connect(self.generateP)
        self.isPrime.clicked.connect(self.isPPrime)
        self.find_ca_da_cb_db.clicked.connect(self.findCaDaCbDb)
        self.send.clicked.connect(self.sendMessage)
        self.encrypt_file.clicked.connect(self.sendToFile)
        self.inputFilePathButton.clicked.connect(lambda: self.getPath(self.inputFilePath))
        self.outputFilePathButton.clicked.connect(lambda: self.getPath(self.outputFilePath))

        reg_ex = QRegExp(r'[1-9]{1}[0-9]+')
        input_validator = QRegExpValidator(reg_ex, self.bits)
        self.bits.setValidator(input_validator)
        input_validator = QRegExpValidator(reg_ex, self.p)
        self.p.setValidator(input_validator)

    def generateP(self):
        self.p.setText(str(generate_prime(int(self.bits.text()))))

        self.ca.setText('')
        self.da.setText('')
        self.cb.setText('')
        self.db.setText('')

    def isPPrime(self):
        try:
            if not isprime(int(self.p.text())):
                self.p.setText('')
        except:
            pass

    def findCaDaCbDb(self):
        if int(self.bits.text()) >= 9:
            p = int(self.p.text())
            ca, da = generate_c_d(p)
            cb, db = generate_c_d(p)

            self.ca.setText(str(ca))
            self.da.setText(str(da))
            self.cb.setText(str(cb))
            self.db.setText(str(db))

    def sendMessage(self):
        try:
            p = int(self.p.text())
            ca = int(self.ca.text())
            da = int(self.da.text())
            cb = int(self.cb.text())
            db = int(self.db.text())

            self.output.setText(send_message(self.input.toPlainText(), p, ca, da, cb, db))
        except:
            pass

    def sendToFile(self):
        p = int(self.p.text())
        ca = int(self.ca.text())
        da = int(self.da.text())
        cb = int(self.cb.text())
        db = int(self.db.text())

        send_message('', p, ca, da, cb, db, self.inputFilePath.text(), self.outputFilePath.text())

    def getPath(self, obj):
        path = QFileDialog.getOpenFileName()[0]
        obj.setText(path)

    def retranslateUi(self, Shamir):
        _translate = QtCore.QCoreApplication.translate
        Shamir.setWindowTitle(_translate("Shamir", "Shamir"))
        self.cypherName.setText(_translate("Shamir", "Shamir"))
        self.label.setText(_translate("Shamir", "p"))
        self.label_4.setText(_translate("Shamir", "Количество бит"))
        self.generate_p.setText(_translate("Shamir", "Сгенерировать"))
        self.isPrime.setText(_translate("Shamir", "Проверить на простоту"))
        self.find_ca_da_cb_db.setText(_translate("Shamir", "Найти ca, da, cb, db"))
        self.label_2.setText(_translate("Shamir", "ca"))
        self.label_5.setText(_translate("Shamir", "cb"))
        self.label_3.setText(_translate("Shamir", "da"))
        self.label_6.setText(_translate("Shamir", "db"))
        self.send.setText(_translate("Shamir", "Передать"))
        self.inputFileText.setText(_translate("Shamir", "Входной файл  "))
        self.inputFilePathButton.setText(_translate("Shamir", "Указать путь"))
        self.outputFileText.setText(_translate("Shamir", "Выходной файл"))
        self.outputFilePathButton.setText(_translate("Shamir", "Указать путь"))
        self.encrypt_file.setText(_translate("Shamir", "Передать"))
